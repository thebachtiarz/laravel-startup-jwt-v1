$(document).on('keyup', '#form-name', function (e) { (event.keyCode === 13) ? (e.preventDefault(), $('#form-email').focus()) : '' });
$(document).on('keyup', '#form-email', function (e) { (event.keyCode === 13) ? (e.preventDefault(), $('#form-password').focus()) : '' });
$(document).on('keyup', '#form-password', function (e) { (event.keyCode === 13) ? (e.preventDefault(), $('#form-repassword').focus()) : '' });
$(document).on('keyup', '#form-repassword', function (e) { (event.keyCode === 13) ? (e.preventDefault(), $('#form-submit').click()) : '' });
$(document).on('click', '#form-submit', function () {
    let name = $('#form-name').val();
    let email = $('#form-email').val();
    let password = $('#form-password').val();
    let repassword = $('#form-repassword').val();
    let agree = $('#form-agree').is(":checked");
    if (name && email && password && repassword && agree) { if (password == repassword) { submitRegister(name, email, encryptPassword(password), encryptPassword(repassword)); } else { $('#form-repassword').val(''), $('#form-repassword').attr('placeholder', "Please type password again") } }
    if (!name) { $('#form-name').attr('placeholder', "Name can't be empty") }
    if (!email) { $('#form-email').attr('placeholder', "Email can't be empty") }
    if (!password) { $('#form-password').attr('placeholder', "Password can't be empty") }
    if (!repassword) { $('#form-repassword').attr('placeholder', "Retype Password can't be empty") }
});
const submitRegister = (name, email, password, repassword) => axios.post(`/api/auth/register`, { name, email, password, repassword }).then(response => registerResponse(response.data)).catch(error => $('#view-register-msg').html(spanMessage('danger', error)));
const registerResponse = async (data) => { await sleep(1000); if (data.status == 'success') { $('#view-register-msg').html(spanMessage('success', data.message)), redirectTo('/signin') } else { let error = ''; data.message.email ? data.message.email.forEach(msg => error += spanMessage('info', msg)) : error += spanMessage('info', data.message), $('#view-register-msg').html(error) } }
const spanMessage = (color, message) => `<p class="text-bold text-${color}">${message}</p>`;
$(() => {
    // create register form
    let register = `<div class="register-box"><div class="register-logo"><a href="/" class="text-white" style="font-size: 40px; opacity: .8;"><b>Laravel</b> Apps</a></div><div class="card shadow-lg p-1 mb-5 bg-white rounded"><div class="card-body register-card-body"><p class="login-box-msg" id="view-register-msg">Register a new membership</p><div class="mb-3"><div class="input-group mb-3"><input type="text" class="form-control" id="form-name" placeholder="Full name"><div class="input-group-append"><div class="input-group-text"><span class="fas fa-user"></span></div></div></div><div class="input-group mb-3"><input type="email" class="form-control" id="form-email" placeholder="Email"><div class="input-group-append"><div class="input-group-text"><span class="fas fa-envelope"></span></div></div></div><div class="input-group mb-3"><input type="password" class="form-control" id="form-password" placeholder="Password"><div class="input-group-append"><div class="input-group-text"><span class="fas fa-lock"></span></div></div></div><div class="input-group mb-3"><input type="password" class="form-control" id="form-repassword" placeholder="Retype password"><div class="input-group-append"><div class="input-group-text"><span class="fas fa-lock"></span></div></div></div><div class="row"><div class="col-7"><div class="icheck-primary"><input type="checkbox" id="form-agree"><label for="form-agree">I agree to the <a href="/register/terms">terms</a></label></div></div><div class="col-5"><button type="submit" class="btn btn-primary btn-block btn-flat text-bold" id="form-submit"><i class="fas fa-user-plus"></i>&ensp;Register</button></div></div></div><p class="mb-1"><a href="/signin/lost">I forgot my password</a></p><p class=""><a href="/signin" class="text-center">I already have a membership</a></p></div></div></div>`;
    $('#view-register-form').prepend(register);
});
